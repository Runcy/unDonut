■unDonut +mod.1.48 の ソースです。


MS Visual Studio .net 2008 sp1(Standard) + WTL8.0 で開発しています。
一応、vs.net2003,2005 でも  でコンパイル通るようにしてるつもりです。
（しかしどの程度大丈夫かは確認してません）

donut9.00.sln  vs.net 2008 用 (win32,win64 UNICODE版)
donut8.00.sln  vs.net 2005 用 (win32,win64 ??)
donut7.10.sln  vs.net 2003 用 (win32 マルチバイト版)
※ 2003用は vcslncnv.vbs で変換したものですが、2005,8用にはx64の設定があり、
   これが残ったままだとvs2003が起動しないので省いたモノにしています。

オプション設定は、各vcprojで共通でなく、
・2003  マルチバイト版
・2005  (不定、適当状態)
・2008  UNICODE版
になってます。一応、2003でコンパイルしたものならwin9x系で起動するようです。
(けど、2003でコンパイルしたUnicode版は不具合があった?り)

.vcprojには、コンパイラ側のatlヘッダも登録している場合がありますが、
当然環境によってパスは違いますので、atl/を削除するなりなんなりで
対処してやってください。

多少(結構)弄ってしまってるので、面倒がってwtl8.0/include も一緒に
いれてます. (CPL,MS-PLなら大丈夫そうだと思い）


ATL7以上の機能が使われているため、vc++ 200? express + platform sdk
環境では、まともにコンパイルできません。

(一時期、Platform SDK付属の不完全な ATL3 に
http://hpcgi2.nifty.com/tokd/index.cgi?HowToBuildDonutL
で公開されているパッチをあてた版で、無理やりコンパイルは通るようには
してみました。といってもコンパイルの通らない箇所をコメントアウトして
対処してたりするので、使えない機能があったり、バグが発生する状態です。
・ATL::CMutexがないので、それを使った排他制御が機能していません...ので
　dfgの自動保存等でハング等の不具合が発生する可能性があります。
・AtlHostEx.h周辺が不十分な対応のため、ドラッグ＆ドロップ関係(内部的にそれを
  用いたものも)の処理がちゃんと機能していません。
などなど. 1.40現在、すでにatl3で通らない処理をしていると思うので、
するなら手直しが必要でしょう）


※リソース(undonut.rc, release.h)は、基本的に手修正状態です。
とくに.rc中では#ifを使っていて、vs上で編集するとそれらが消えてしまいます
ので、vsで作業するときは気をつけてください。



■設定補足

stdafx.h の#define 定義で設定する定義について.

USE_ORG_UNDONUT_INI
　　これを定義すると、unDonut+ で変更のあった unDonut.ini, search.ini,.url
　　に格納される拡張プロパティ等の情報を、元のunDonut互換で読み書きする
　　版にします。
　　※もっと早くに認識していれば unDonut 互換に戻せたかもしれませんが、
　　今さら戻すほうが被害多そうなので、これを配布版で定義することはないです.

USE_INNER_MANIFEST
　　これをC/C++コンパイラ＆リソース・コンパイラのオプションで定義すると、
　　manifestファイルを内臓するようになります。ただ 32ビット版の場合
　　unicodeファイルがあると不具合がでることもあるようなので、
　　配布では64ビット版のみ内臓しています。

USE_DIET
　　これをC/C++コンパイラ＆リソース・コンパイラのオプションで定義すると、
　　正規表現やらabout:ファイル名、やらの機能を削除して、実行ファイルが
　　多少小さいexeを作れます。
　　1.41時点でのお試し。
　　あまりサイズ減らない割りに中途半端に機能なくなるのでうれしくありません。


■ソースは好みでインデント等整形しなおしたり（gnu indent や Uncrustify
+手修正）、(他人には)無意味に式文表現を変えたりしています.
（過去ソースと比較する場合不便だしエンバグの危険もあるので(というか
　実際やっちまったるし) 仕事じゃ禁じ手に近い作業ですが、モチベーション
　をいいわけに触っています。）

　ソース比較をされる方、ごめんなさい。

※なるべく自分が触ったところは //+++ や /*+++*/ を付けています。
が、一括置換したり、些細だったり、忘れてたりもあるので...



■ 1.33
unicode(api)版へ移行しました。
大筋はすぐでしたが、やはり、細々と不具合は発生し、
だいぶマシになりましたが、まだなにかあるかもです。

UNICODE化のメリットは扱える文字が増えることだけれど、個人的には
レガシーアプリぽさが一つ減ってソフト(ソース)の寿命が多少延びたような
感じです。気持ちの問題ですが

.dfg .ini ファイルの操作に使っている win-api がファイルに書き出す段で
sjisにしてくれるので楽な反面、UNICODE文字をそのまま収められないので、
（ひょっとして何かの設定で切り替えられるのかもしれないけれどわからない）、
sjisにできないunicodeがあればutf8化して、urlと同様の%HH化して収める
ことで逃げました。
.iniや.dfg中の可読性がひどくなるけれど、そうそう直接読むものでもないし。
既存の頁タイトル等で%HH が使われていると誤変換するかもだけど、余り無さそで。
（.ini,.dfgを自前でファイルアクセスしてutf8化しようかとも考えましたが
　(ほぼCIniFile関係で閉じるはず)、個人の.ini,dfgの変換や効率的なアクセス
　とか排他制御を思ったりすると面倒くさくなってとりあえず今の形に）


■ 1.36
url別セキュリティ対応で、vs2008では tr1の正規表現(regex)ライブラリを、
vs2003,2005ではboostの(tr1互換)regexを使っています。
ので、vs2008はsp1を適応しているの前提、vs2003,2005ではboostのセッティングが
されている必要があります。

■ 1.40
MB版作成のためターゲット設定を増やしました。release-mb,debug-mb。
ただpluginについては、必要なもののみ（-mbを用意していない奴は実はmb版)

■ 1.41
ターゲットに Relase-DIET,Debug-DIETを追加。上記USE_DIET参照.


■ 1.47

1末にちょっと弄って、も少し何かしてから、と思っていたら一ヶ月たって
しまい、今後も(おそらく4～6ヶ月ほどは)本業やら何やらでundonutまで
手が回らない状態が続きそうなので、とりあえず、さらしておきます。

まあ、こんなこと書いても弄ったらアップすると思うので、今までとさして
状況が代わるわけではないのですが、その後も微妙だったりするので、
フェードアウトしてしまったらすみません。

待たずに、分岐版作ってくださる人がいたら非常にありがたいのですが^^;


■ 1.48

新しい人が現れた?ようなんで、あわてて、だしそこねていた1.48のソース
をだしておきます... 正確には1.48以降で多少弄った状態です。

ie8betaのときに閉じたルーチンが一部、正式のie8では大丈夫だったので
復活しただけ... vistaのie8だと大丈夫なのにxpのie8だとバグったまま
の箇所があったのでそこはxpだけとめたり...
(でも、ちょうどそのへんをpart26の816の方がie8対応されてるようなので)
あとwtlは8.1(以降のsvn-trunkをちょっと反映)にしたかな.

近況的には、6ヶ月ってサバを読んだ値だったのですが。
やっぱり足りてませんね。まあ、よくある話ですが。さらにゴタゴタが
発生する予定のためunDonutどころじゃないというのが正直なところ....
ゴメンなさい。




■ ライセンス

ソース中 mtl の部分については、
// All rights unreserved.
//
// This file is a part of Mb Template Library.
// The code and information is *NOT* provided "as-is" without
// warranty of any kind, either expressed or implied.
となっており、
また、元祖donut配布サイトは消失してしまっていますが、
internet archaiveに記録されているサイトのdonutの配布ページには
“このソースコードのあらゆる利用と改変を認めます。
またそれに伴う実行ファイルのあらゆる形式での再配布を認めます。”
と書かれているようです。

後継の作者はとりたてて面倒なことはかかれていないと思われるので、
おそらく、DonutR,DonutP,unDonut,unDonut+,ともに同様に
みなせるだろうと思われます。
もちろん unDonut+mod も同様。

plugin関係は、donutのではなく、そのプラグインごとに
違いますので、個別に判断してください。


もし、このソースから分岐/流用したいかたは気にせずどうぞ、です。
